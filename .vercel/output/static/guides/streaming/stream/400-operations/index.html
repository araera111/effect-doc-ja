<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar data-theme="dark" class="astro-ds2wt7hw"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Operations | Effect日本語版ドキュメント</title><link rel="canonical"/><link rel="shortcut icon" href="/icon.png" type="image/png"/><meta name="generator" content="Astro v4.14.5"/><meta name="generator" content="Starlight v0.26.1"/><meta property="og:title" content="Operations"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="Effect日本語版ドキュメント"/><meta name="twitter:card" content="summary_large_image"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.C-KpjUOJ.css">
<style>:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-x444flib){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-x444flib){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-x444flib){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-x444flib){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-x444flib){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-x444flib){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-x444flib){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-x444flib){vertical-align:middle}
svg:where(.astro-mzbodlcp){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
starlight-tabs:where(.astro-oy26qiqb){display:block}.tablist-wrapper:where(.astro-oy26qiqb){overflow-x:auto}:where(.astro-oy26qiqb)[role=tablist]{display:flex;list-style:none;border-bottom:2px solid var(--sl-color-gray-5);padding:0}.tab:where(.astro-oy26qiqb){margin-bottom:-2px}.tab:where(.astro-oy26qiqb)>:where(.astro-oy26qiqb)[role=tab]{display:flex;align-items:center;gap:.5rem;padding:0 1.25rem;text-decoration:none;border-bottom:2px solid var(--sl-color-gray-5);color:var(--sl-color-gray-3);outline-offset:var(--sl-outline-offset-inside);overflow-wrap:initial}.tab:where(.astro-oy26qiqb) :where(.astro-oy26qiqb)[role=tab][aria-selected=true]{color:var(--sl-color-white);border-color:var(--sl-color-text-accent);font-weight:600}.tablist-wrapper:where(.astro-oy26qiqb)~[role=tabpanel]{margin-top:1rem}
.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
.sl-link-button:where(.astro-6gpctszv){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-6gpctszv).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-6gpctszv).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-6gpctszv).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-6gpctszv).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-6gpctszv) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-6gpctszv){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-6gpctszv){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-6gpctszv):not(:where(p *)){margin-block:1rem}
</style><script type="module" src="/_astro/hoisted.FicniJ2Z.js"></script>
<script type="module" src="/_astro/page.LS5KDvwX.js"></script></head> <body class="astro-ds2wt7hw"> <a href="#_top" class="astro-4zievzub">Skip to content</a>  <div class="page sl-flex astro-444rl2wv"> <header class="header astro-444rl2wv"><div class="header sl-flex astro-y4sn2rzm"> <div class="title-wrapper sl-flex astro-y4sn2rzm"> <a href="/" class="site-title sl-flex astro-674d5lyb">  <span class="astro-674d5lyb"> Effect日本語版ドキュメント </span> </a>  </div> <div class="sl-flex astro-y4sn2rzm"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-vplcdv4k"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-vplcdv4k"> <svg aria-hidden="true" class="astro-vplcdv4k astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-vplcdv4k" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-vplcdv4k" style="display: none;"> <kbd class="astro-vplcdv4k">Ctrl</kbd><kbd class="astro-vplcdv4k">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-vplcdv4k"> <div class="dialog-frame sl-flex astro-vplcdv4k">  <button data-close-modal class="sl-flex md:sl-hidden astro-vplcdv4k"> Cancel </button> <div class="search-container astro-vplcdv4k"> <div id="starlight__search" class="astro-vplcdv4k"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script>    </div> <div class="sl-hidden md:sl-flex right-group astro-y4sn2rzm"> <div class="sl-flex social-icons astro-y4sn2rzm"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-a5kxgq6d"><span class="sr-only astro-a5kxgq6d">GitHub</span><svg aria-hidden="true" class="astro-a5kxgq6d astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-6mzzj2bg"> <span class="sr-only astro-6mzzj2bg">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-6mzzj2bg astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-6mzzj2bg"> <option value="dark" class="astro-6mzzj2bg">Dark</option><option value="light" class="astro-6mzzj2bg">Light</option><option value="auto" selected="true" class="astro-6mzzj2bg">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-6mzzj2bg astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-444rl2wv" aria-label="Main"> <starlight-menu-button class="astro-tzz67r6l"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-tzz67r6l"> <svg aria-hidden="true" class="astro-tzz67r6l astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-444rl2wv"> <div class="sidebar-content sl-flex astro-444rl2wv"> <sl-sidebar-state-persist data-hash="01kof5i" class="astro-epwuevht"> <ul class="top-level astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Introduction</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/introduction/101-introduction_jp/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectへようこそ</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/introduction/201-why-effect_jp/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">なぜEffectなのか？</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/introduction/300-quickstart_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">クイックスタート</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Guides</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Effect Essentials</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effect Essentials</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/100-importing-effect/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectのインポート</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/200-the-effect-type_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effect型</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/300-creating-effects_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectの作成</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/400-running-effects_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectの実行</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/500-using-generators_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectにおけるジェネレーターの使用</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/effect-essentials/600-pipeline_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">パイプラインの構築</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Error Management</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/error-management/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Error Management</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/100-two-error-typesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">二種類のエラー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/1000-error-channel-operationsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">エラーチャンネル操作</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/1100-sequential-and-parallel-errorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">並行および逐次エラー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/1200-yieldable-errorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Yield可能なエラー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/200-expected-errorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">予期されるエラー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/300-unexpected-errorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">予期しないエラー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/400-fallbackmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">フォールバック</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/500-matchingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">マッチング</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/600-retryingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">再試行</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/700-timing-outmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">タイムアウト</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/800-sandboxingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">サンドボックス化</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/error-management/900-error-accumulationmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">エラーの蓄積</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Resource Management</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/resource-management/100-scopemdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">スコープ</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">patterns</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/resource-management/patterns/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Patterns</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/resource-management/patterns/100-sequence-of-operations-with-compensating-actions-on-failuremdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">失敗時の補償アクションを伴う操作のシーケンス</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <a href="/guides/resource-management/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Resource Management</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Requirements Management</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/requirements-management/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Requirements Management</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/requirements-management/100-servicesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">サービスの管理</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/requirements-management/200-default-servicesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">デフォルトサービス</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/requirements-management/300-layersmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">レイヤーの管理</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/requirements-management/400-dependency-memoizationmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">レイヤーのメモ化</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Observability</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/observability/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Observability</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/observability/100-loggingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ロギング</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/observability/200-supervisormdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Supervisor</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Telemetry</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/observability/telemetry/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Telemetry</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/observability/telemetry/100-intromdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectにおけるテレメトリの紹介</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/observability/telemetry/200-metricsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectにおけるメトリクスの導入</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/observability/telemetry/300-tracingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectにおけるトレーシングの導入</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <a href="/guides/configuration/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Configuration</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/500-runtimemdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">実行時システムの紹介(Introduction to Runtime)</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Sceduling</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/sceduling/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Scheduling</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/sceduling/100-introductionmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">スケジューリングの紹介</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/sceduling/200-repetitionmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">繰り返し</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/sceduling/300-built-in-schedulesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">組み込みスケジュール</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/sceduling/400-schedule-combinatorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">スケジュール・コンビネータ</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/sceduling/500-examplesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">例</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">State Management</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/state-management/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">State Management</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/state-management/100-refmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Ref</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/state-management/200-synchronizedrefmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">SynchronizedRef</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <a href="/guides/620-batching-cachingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Batching</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Caching</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/caching/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Caching</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/caching/100-effect-cachingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">キャッシングエフェクト</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/caching/200-cachemdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">キャッシュ</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Concurrency</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/concurrency/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Concurrency</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/100-concurrency-optionsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">同時実行オプション</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/110-fibersmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Fibers</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/120-interruption-modelmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectの障害モデル入門</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/130-deferredmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Deferred</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/140-queuemdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">キュー</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/150-pubsubmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">PubSub</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/160-semaphoremdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">セマフォ</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/concurrency/50-basic-concurrencymdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">基本的な並行処理</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Streaming</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/streaming/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Streaming</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/300-subscriptionrefmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">SubscriptionRef</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Stream</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Streams</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/100-introductionmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ストリーム入門</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/200-creatingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ストリームの作成</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/300-resourceful-streamsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">リソースフルなストリーム</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/400-operations/" aria-current="page" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Operations</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/500-consuming-streamsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ストリームの消費</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/600-error-handlingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ストリームにおけるエラー処理</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/stream/700-schedulingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ストリームのスケジューリング</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Sink</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Sinks</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/100-introductionmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Sinksの紹介</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/200-creatingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Sinksの作成</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/300-operationsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Sink Operations</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/400-parallel-operatorsmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">並行演算子</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/streaming/sink/500-leftoversmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Leftovers</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Testing</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/testing/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Testing</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/testing/100-testclockmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">TestClock</span>  </a> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <a href="/guides/700-control-flowmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Effectの制御フロー演算子入門</span>  </a> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Code Style</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4"> <li class="astro-tkdbfgf4"> <a href="/guides/code-style/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">Code Style</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/code-style/100-dualmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">デュアルAPI</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/code-style/200-branded-typesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ブランド型</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/code-style/300-pattern-matchingmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">パターンマッチング</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/code-style/400-domdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">過剰なネストを簡素化する</span>  </a> </li><li class="astro-tkdbfgf4"> <a href="/guides/code-style/500-guidelinesmdx_ja/" class="astro-tkdbfgf4"> <span class="astro-tkdbfgf4">ガイドライン</span>  </a> </li> </ul>  </details> </li> </ul>  </details> </li><li class="astro-tkdbfgf4"> <details open class="astro-tkdbfgf4"> <summary class="astro-tkdbfgf4"> <div class="group-label astro-tkdbfgf4"> <span class="large astro-tkdbfgf4">Blog</span>  </div> <svg aria-hidden="true" class="caret astro-tkdbfgf4 astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-tkdbfgf4">  </ul>  </details> </li> </ul>  </sl-sidebar-state-persist> <div class="md:sl-hidden astro-epwuevht"> <div class="mobile-preferences sl-flex astro-misogbc3"> <div class="sl-flex social-icons astro-misogbc3"> <a href="https://github.com/withastro/starlight" rel="me" class="sl-flex astro-a5kxgq6d"><span class="sr-only astro-a5kxgq6d">GitHub</span><svg aria-hidden="true" class="astro-a5kxgq6d astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-6mzzj2bg"> <span class="sr-only astro-6mzzj2bg">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-6mzzj2bg astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-6mzzj2bg"> <option value="dark" class="astro-6mzzj2bg">Dark</option><option value="light" class="astro-6mzzj2bg">Light</option><option value="auto" selected="true" class="astro-6mzzj2bg">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-6mzzj2bg astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div>  <script>
	(() => {
		try {
			if (!matchMedia('(min-width: 50em)').matches) return;
			const scroller = document.getElementById('starlight__sidebar');
			/** @type {HTMLElement | null} */
			const target = document.querySelector('sl-sidebar-state-persist');
			const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
			if (!scroller || !target || !state || target.dataset.hash !== state.hash) return;
			target
				.querySelectorAll('details')
				.forEach((el, idx) => typeof state.open[idx] === 'boolean' && (el.open = state.open[idx]));
			scroller.scrollTop = state.scroll;
		} catch {}
	})();
</script>  </div> </div> </nav> <div class="main-frame astro-444rl2wv">   <div class="lg:sl-flex astro-iia7liwg"> <aside class="right-sidebar-container astro-iia7liwg"> <div class="right-sidebar astro-iia7liwg"> <div class="lg:sl-hidden astro-mgyjzhcd"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-i5ioxqqj"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-i5ioxqqj"><details id="starlight__mobile-toc" class="astro-i5ioxqqj"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-i5ioxqqj"><div class="toggle sl-flex astro-i5ioxqqj">On this page<svg aria-hidden="true" class="caret astro-i5ioxqqj astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-i5ioxqqj"></span></summary><div class="dropdown astro-i5ioxqqj"><ul class="isMobile astro-wbc2ynvf" style="--depth: 0;"> <li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#_top" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#tapping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Tapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#taking-elements" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Taking Elements</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#exploring-streams-as-an-alternative-to-async-iterables" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Exploring Streams as an Alternative to Async Iterables</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#mapping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Mapping</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#basic-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Basic Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#effectful-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Effectful Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#stateful-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Stateful Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mapping-and-flattening" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Mapping and Flattening</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mapping-to-a-constant-value" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Mapping to a Constant Value</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#filtering" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Filtering</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#scanning" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Scanning</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#draining" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Draining</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#detecting-changes-in-a-stream" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Detecting Changes in a Stream</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#zipping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Zipping</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#handling-stream-endings" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Handling Stream Endings</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#zipping-streams-at-different-rates" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Zipping Streams at Different Rates</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#pairing-with-previous-and-next-elements" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Pairing with Previous and Next Elements</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#indexing-stream-elements" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Indexing Stream Elements</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#cartesian-product-of-streams" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Cartesian Product of Streams</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#partitioning" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Partitioning</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#partition" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">partition</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#partitioneither" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">partitionEither</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#groupby" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">GroupBy</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupbykey" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupByKey</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupby-1" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupBy</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#grouping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Grouping</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#grouped" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">grouped</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupedwithin" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupedWithin</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#concatenation" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Concatenation</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#simple-concatenation" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Simple Concatenation</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#concatenating-multiple-streams" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Concatenating Multiple Streams</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#advanced-concatenation-with-flatmap" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Advanced Concatenation with flatMap</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#merging" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Merging</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#merge" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">merge</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#termination-strategy" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Termination Strategy</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mergewith" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">mergeWith</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#interleaving" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Interleaving</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#interspersing" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Interspersing</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#intersperse" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">intersperse</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#intersperseaffixes" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">intersperseAffixes</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#broadcasting" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Broadcasting</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#buffering" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Buffering</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#buffer" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">buffer</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#debouncing" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Debouncing</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#throttling" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Throttling</span> </a> <ul class="isMobile astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#shape-strategy-default" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Shape Strategy (Default)</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#enforce-strategy" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Enforce Strategy</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#burst-option" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">burst option</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-mgyjzhcd"><div class="sl-container astro-mgyjzhcd"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-wbc2ynvf" style="--depth: 0;"> <li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#_top" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#tapping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Tapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#taking-elements" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Taking Elements</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#exploring-streams-as-an-alternative-to-async-iterables" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Exploring Streams as an Alternative to Async Iterables</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#mapping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Mapping</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#basic-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Basic Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#effectful-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Effectful Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#stateful-mapping" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Stateful Mapping</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mapping-and-flattening" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Mapping and Flattening</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mapping-to-a-constant-value" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Mapping to a Constant Value</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#filtering" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Filtering</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#scanning" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Scanning</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#draining" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Draining</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#detecting-changes-in-a-stream" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Detecting Changes in a Stream</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#zipping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Zipping</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#handling-stream-endings" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Handling Stream Endings</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#zipping-streams-at-different-rates" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Zipping Streams at Different Rates</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#pairing-with-previous-and-next-elements" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Pairing with Previous and Next Elements</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#indexing-stream-elements" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Indexing Stream Elements</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#cartesian-product-of-streams" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Cartesian Product of Streams</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#partitioning" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Partitioning</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#partition" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">partition</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#partitioneither" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">partitionEither</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#groupby" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">GroupBy</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupbykey" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupByKey</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupby-1" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupBy</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#grouping" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Grouping</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#grouped" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">grouped</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#groupedwithin" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">groupedWithin</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#concatenation" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Concatenation</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#simple-concatenation" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Simple Concatenation</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#concatenating-multiple-streams" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Concatenating Multiple Streams</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#advanced-concatenation-with-flatmap" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Advanced Concatenation with flatMap</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#merging" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Merging</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#merge" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">merge</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#termination-strategy" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Termination Strategy</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#mergewith" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">mergeWith</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#interleaving" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Interleaving</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#interspersing" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Interspersing</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#intersperse" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">intersperse</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#intersperseaffixes" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">intersperseAffixes</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#broadcasting" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Broadcasting</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#buffering" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Buffering</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#buffer" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">buffer</span> </a>  </li> </ul>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#debouncing" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Debouncing</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 0;"> <a href="#throttling" class="astro-wbc2ynvf" style="--depth: 0;"> <span class="astro-wbc2ynvf" style="--depth: 0;">Throttling</span> </a> <ul class="astro-wbc2ynvf" style="--depth: 1;"> <li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#shape-strategy-default" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Shape Strategy (Default)</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#enforce-strategy" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">Enforce Strategy</span> </a>  </li><li class="astro-wbc2ynvf" style="--depth: 1;"> <a href="#burst-option" class="astro-wbc2ynvf" style="--depth: 1;"> <span class="astro-wbc2ynvf" style="--depth: 1;">burst option</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-iia7liwg">  <main data-pagefind-body lang="en" dir="ltr" class="astro-ds2wt7hw">    <div class="content-panel astro-qq65ezpp"> <div class="sl-container astro-qq65ezpp"> <h1 id="_top" class="astro-hbp5tgjk">Operations</h1>  </div> </div>  <div class="content-panel astro-qq65ezpp"> <div class="sl-container astro-qq65ezpp"> <div class="sl-markdown-content"> <p>In this section, we’ll explore some essential operations you can perform on streams. These operations allow you to manipulate and interact with stream elements in various ways.</p>
<h2 id="tapping">Tapping</h2>
<p>Tapping is an operation that involves running an effect on each emission of the stream. It allows you to observe each element, perform some effectful operation, and discard the result of this observation. Importantly, the <code dir="auto">Stream.tap</code> operation does not alter the elements of the stream, and it does not affect the return type of the stream.</p>
<p>For instance, you can use <code dir="auto">Stream.tap</code> to print each element of a stream:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.j8ofn.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Console, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">before mapping: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> * </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">after mapping: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before mapping: 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after mapping: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before mapping: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after mapping: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before mapping: 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after mapping: 6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 2, 4, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Console, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3).pipe(  Stream.tap((n) => Console.log(&#x60;before mapping: ${n}&#x60;)),  Stream.map((n) => n * 2),  Stream.tap((n) => Console.log(&#x60;after mapping: ${n}&#x60;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:before mapping: 1after mapping: 2before mapping: 2after mapping: 4before mapping: 3after mapping: 6{ _id: &#x27;Chunk&#x27;, values: [ 2, 4, 6 ] }*/"><div></div></button></div></figure></div>
<h2 id="taking-elements">Taking Elements</h2>
<p>Another essential operation is taking elements, which allows you to extract a specific number of elements from a stream. Here are several ways to achieve this:</p>
<ul>
<li><code dir="auto">take</code>. To extract a fixed number of elements.</li>
<li><code dir="auto">takeWhile</code>. To extract elements until a certain condition is met.</li>
<li><code dir="auto">takeUntil</code>. To extract elements until a specific condition is met.</li>
<li><code dir="auto">takeRight</code>. To extract a specified number of elements from the end.</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">iterate</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> + </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// Using `take` to extract a fixed number of elements:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(stream</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s1))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 2, 3, 4 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// Using `takeWhile` to extract elements until a certain condition is met:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">takeWhile</span><span style="--0:#D6DEEB;--1:#403F53">(stream</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> &#x3C; </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s2))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 2, 3, 4 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// Using `takeUntil` to extract elements until a specific condition is met:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s3</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">takeUntil</span><span style="--0:#D6DEEB;--1:#403F53">(stream</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> === </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s3))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 2, 3, 4, 5 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// Using `takeRight` to extract a specified number of elements from the end:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s4</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">takeRight</span><span style="--0:#D6DEEB;--1:#403F53">(s3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s4))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 3, 4, 5 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.iterate(0, (n) => n + 1);// Using &#x60;take&#x60; to extract a fixed number of elements:const s1 = Stream.take(stream, 5);Effect.runPromise(Stream.runCollect(s1)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 2, 3, 4 ] }*/// Using &#x60;takeWhile&#x60; to extract elements until a certain condition is met:const s2 = Stream.takeWhile(stream, (n) => n < 5);Effect.runPromise(Stream.runCollect(s2)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 2, 3, 4 ] }*/// Using &#x60;takeUntil&#x60; to extract elements until a specific condition is met:const s3 = Stream.takeUntil(stream, (n) => n === 5);Effect.runPromise(Stream.runCollect(s3)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 2, 3, 4, 5 ] }*/// Using &#x60;takeRight&#x60; to extract a specified number of elements from the end:const s4 = Stream.takeRight(s3, 3);Effect.runPromise(Stream.runCollect(s4)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 3, 4, 5 ] }*/"><div></div></button></div></figure></div>
<h3 id="exploring-streams-as-an-alternative-to-async-iterables">Exploring Streams as an Alternative to Async Iterables</h3>
<p>When working with asynchronous data sources, like async iterables, you often need to consume data in a loop until a certain condition is met. This tutorial introduces how you can achieve similar behavior using Streams in a beginner-friendly manner.</p>
<p>In async iterables, data consumption can continue in a loop until a break or return statement is encountered. To replicate this behavior with Streams, you have a couple of options:</p>
<ol>
<li>
<p><strong>Stream.takeUntil:</strong> This function allows you to take elements from a stream until a specified condition evaluates to true. It’s akin to breaking out of a loop in async iterables when a certain condition is met.</p>
</li>
<li>
<p><strong>Stream.toPull:</strong> The <code dir="auto">Stream.toPull</code> function is another way to replicate looping through async iterables. It returns an effect that repeatedly pulls data chunks from the stream. This effect can fail with <code dir="auto">None</code> when the stream is finished or with <code dir="auto">Some</code> error if it fails.</p>
</li>
</ol>
<p>Let’s take a closer look at the second option, <code dir="auto">Stream.toPull</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// Simulate a chunked stream</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromIterable</span><span style="--0:#D6DEEB;--1:#403F53">([</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">])</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">rechunk</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">program</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">gen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">function* </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// Create an effect to get data chunks from the stream</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">getChunk</span><span style="--0:#C792EA;--1:#8D46B4"> = yield* </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toPull</span><span style="--0:#D6DEEB;--1:#403F53">(stream)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#809191;--1:#5E6578">// Continuously fetch and process chunks</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">while </span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">chunk</span><span style="--0:#C792EA;--1:#8D46B4"> = yield* </span><span style="--0:#D6DEEB;--1:#403F53">getChunk</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(chunk)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">scoped</span><span style="--0:#D6DEEB;--1:#403F53">(program))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">, console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">error</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 2 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 3, 4 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 5 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">(FiberFailure) Error: {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">"_id": "Option",</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">"_tag": "None"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;// Simulate a chunked streamconst stream = Stream.fromIterable([1, 2, 3, 4, 5]).pipe(Stream.rechunk(2));const program = Effect.gen(function* () {  // Create an effect to get data chunks from the stream  const getChunk = yield* Stream.toPull(stream);  // Continuously fetch and process chunks  while (true) {    const chunk = yield* getChunk;    console.log(chunk);  }});Effect.runPromise(Effect.scoped(program)).then(console.log, console.error);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 2 ] }{ _id: &#x27;Chunk&#x27;, values: [ 3, 4 ] }{ _id: &#x27;Chunk&#x27;, values: [ 5 ] }(FiberFailure) Error: {  &#x22;_id&#x22;: &#x22;Option&#x22;,  &#x22;_tag&#x22;: &#x22;None&#x22;}*/"><div></div></button></div></figure></div>
<p>In this example, we’re using <code dir="auto">Stream.toPull</code> to repeatedly pull data chunks from the <code dir="auto">stream</code>. The code enters a loop and continues to fetch and display chunks until there’s no more data left to process.</p>
<h2 id="mapping">Mapping</h2>
<p>In this section, we’ll explore how to transform elements within a stream using the <code dir="auto">Stream.map</code> family of operations. These operations allow you to apply a function to each element of the stream, producing a new stream with the transformed values.</p>
<h3 id="basic-mapping">Basic Mapping</h3>
<p>The <code dir="auto">Stream.map</code> operation applies a given function to all elements of the stream, creating another stream with the transformed values. Let’s illustrate this with an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> + </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 2, 3, 4 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3).pipe(Stream.map((n) => n + 1));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 2, 3, 4 ] }*/"><div></div></button></div></figure></div>
<h3 id="effectful-mapping">Effectful Mapping</h3>
<p>If your transformation involves effects, you can use <code dir="auto">Stream.mapEffect</code> instead. It allows you to apply an effectful function to each element of the stream, producing a new stream with effectful results:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Random, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">20</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">30</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">mapEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Random</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">nextIntBetween</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">n))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 5, 9, 22 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Random, Effect } from &#x22;effect&#x22;;const stream = Stream.make(10, 20, 30).pipe(  Stream.mapEffect((n) => Random.nextIntBetween(0, n)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Example Output:{ _id: &#x27;Chunk&#x27;, values: [ 5, 9, 22 ] }*/"><div></div></button></div></figure></div>
<p>You can evaluate effects concurrently using the <code dir="auto">concurrency</code> option. It allows you to specify the number of concurrent running effects. The results are emitted downstream in the original order.</p>
<p>Let’s write a simple page downloader that fetches URLs concurrently:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">getUrls</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">succeed</span><span style="--0:#D6DEEB;--1:#403F53">([</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">url0</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">url1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">url2</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fetchUrl</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">url</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">succeed</span><span style="--0:#D6DEEB;--1:#403F53">([</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Resource 0-</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">url</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Resource 1-</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">url</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Resource 2-</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">url</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">]);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromIterableEffect</span><span style="--0:#D6DEEB;--1:#403F53">(getUrls)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">mapEffect</span><span style="--0:#D6DEEB;--1:#403F53">(fetchUrl</span><span style="--0:#C792EA;--1:#8D46B4">, { concurrency: </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4"> }</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 'Resource 0-url0', 'Resource 1-url0', 'Resource 2-url0' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 'Resource 0-url1', 'Resource 1-url1', 'Resource 2-url1' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 'Resource 0-url2', 'Resource 1-url2', 'Resource 2-url2' ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const getUrls = Effect.succeed([&#x22;url0&#x22;, &#x22;url1&#x22;, &#x22;url2&#x22;]);const fetchUrl = (url: string) =>  Effect.succeed([    &#x60;Resource 0-${url}&#x60;,    &#x60;Resource 1-${url}&#x60;,    &#x60;Resource 2-${url}&#x60;,  ]);const stream = Stream.fromIterableEffect(getUrls).pipe(  Stream.mapEffect(fetchUrl, { concurrency: 4 }));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ &#x27;Resource 0-url0&#x27;, &#x27;Resource 1-url0&#x27;, &#x27;Resource 2-url0&#x27; ],    [ &#x27;Resource 0-url1&#x27;, &#x27;Resource 1-url1&#x27;, &#x27;Resource 2-url1&#x27; ],    [ &#x27;Resource 0-url2&#x27;, &#x27;Resource 1-url2&#x27;, &#x27;Resource 2-url2&#x27; ]  ]}*/"><div></div></button></div></figure></div>
<h3 id="stateful-mapping">Stateful Mapping</h3>
<p>The <code dir="auto">Stream.mapAccum</code> operation is similar to <code dir="auto">Stream.map</code>, but it transforms elements statefully and allows you to map and accumulate in a single operation. Let’s see how you can use it to calculate the running total of an input stream:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">runningTotal</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">stream</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> Stream.</span><span style="--0:#FFCB8B;--1:#111111">Stream</span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#C792EA;--1:#8D46B4">></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> Stream.</span><span style="--0:#FFCB8B;--1:#111111">Stream</span><span style="--0:#C792EA;--1:#8D46B4">&#x3C;</span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#C792EA;--1:#8D46B4">> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">mapAccum</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">a</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [s </span><span style="--0:#C792EA;--1:#8D46B4">+</span><span style="--0:#D6DEEB;--1:#403F53"> a, s </span><span style="--0:#C792EA;--1:#8D46B4">+</span><span style="--0:#D6DEEB;--1:#403F53"> a]));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3C63B3">runningTotal</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">))))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 3, 6, 10, 15 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const runningTotal = (stream: Stream.Stream<number>): Stream.Stream<number> =>  stream.pipe(Stream.mapAccum(0, (s, a) => [s + a, s + a]));Effect.runPromise(Stream.runCollect(runningTotal(Stream.range(0, 5)))).then(  console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 3, 6, 10, 15 ] }*/"><div></div></button></div></figure></div>
<h3 id="mapping-and-flattening">Mapping and Flattening</h3>
<p>The <code dir="auto">Stream.mapConcat</code> operation is akin to <code dir="auto">Stream.map</code>, but it takes things a step further. It maps each element to zero or more elements of type <code dir="auto">Iterable</code> and then flattens the entire stream. Let’s illustrate this with an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">numbers</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1-2-3</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">4-5</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">6</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">mapConcat</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">s</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">split</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">-</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">map</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">parseInt</span><span style="--0:#D6DEEB;--1:#403F53">(s))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(numbers))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 2, 3, 4, 5, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const numbers = Stream.make(&#x22;1-2-3&#x22;, &#x22;4-5&#x22;, &#x22;6&#x22;).pipe(  Stream.mapConcat((s) => s.split(&#x22;-&#x22;)),  Stream.map((s) => parseInt(s)));Effect.runPromise(Stream.runCollect(numbers)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 2, 3, 4, 5, 6 ] }*/"><div></div></button></div></figure></div>
<p>In this example, we take a stream of strings like <code dir="auto">"1-2-3"</code> and split them into individual numbers, resulting in a flattened stream of integers.</p>
<h3 id="mapping-to-a-constant-value">Mapping to a Constant Value</h3>
<p>The <code dir="auto">Stream.as</code> method allows you to map the success values of a stream to a specified constant value. This can be handy when you want to transform elements into a uniform value. Here’s an example where we map all elements to the <code dir="auto">null</code> value:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">as</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">null</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ null, null, null, null, null ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.range(1, 5).pipe(Stream.as(null));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ null, null, null, null, null ] }*/"><div></div></button></div></figure></div>
<p>In this case, regardless of the original values in the stream, we’ve mapped them all to <code dir="auto">null</code>.</p>
<h2 id="filtering">Filtering</h2>
<p>The <code dir="auto">Stream.filter</code> operation is like a sieve that lets through elements that meet a specified condition. Think of it as a way to sift through a stream and keep only the elements that satisfy the given criteria. Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">11</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">filter</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> % </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4"> === </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 2, 4, 6, 8, 10 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.range(1, 11).pipe(Stream.filter((n) => n % 2 === 0));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 2, 4, 6, 8, 10 ] }*/"><div></div></button></div></figure></div>
<p>In this example, we start with a stream of numbers from 1 to 10 and use <code dir="auto">Stream.filter</code> to retain only the even numbers (those that satisfy the condition <code dir="auto">n % 2 === 0</code>). The result is a filtered stream containing the even numbers from the original stream.</p>
<h2 id="scanning">Scanning</h2>
<p>In this section, we’ll explore the concept of stream scanning. Scans are similar to folds, but they provide a historical perspective. Like folds, scans also involve a binary operator and an initial value. However, what makes scans unique is that they emit every intermediate result as part of the stream.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">scan</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">a</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">b</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">a</span><span style="--0:#C792EA;--1:#8D46B4"> + </span><span style="--0:#D6DEEB;--1:#403F53">b));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 3, 6, 10, 15 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.range(1, 5).pipe(Stream.scan(0, (a, b) => a + b));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 3, 6, 10, 15 ] }*/"><div></div></button></div></figure></div>
<p>In this example, we have a stream of numbers from 1 to 5, and we use <code dir="auto">Stream.scan</code> to perform a cumulative addition starting from an initial value of 0. The result is a stream that emits the accumulated sum at each step: 0, 1, 3, 6, 10, and 15.</p>
<p>Streams scans provide a way to keep a historical record of your stream transformations, which can be invaluable for various applications.</p>
<p>Additionally, if you only need the final result of the scan, you can use <code dir="auto">Stream.runFold</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fold</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runFold</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">a</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">b</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">a</span><span style="--0:#C792EA;--1:#8D46B4"> + </span><span style="--0:#D6DEEB;--1:#403F53">b));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(fold)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">); </span><span style="--0:#809191;--1:#5E6578">// Output: 15</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const fold = Stream.range(1, 5).pipe(Stream.runFold(0, (a, b) => a + b));Effect.runPromise(fold).then(console.log); // Output: 15"><div></div></button></div></figure></div>
<p>In this case, <code dir="auto">Stream.runFold</code> gives you the final accumulated value, which is 15 in this example.</p>
<h2 id="draining">Draining</h2>
<p>In this section, we’ll explore the concept of stream draining. Imagine you have a stream filled with effectful operations, but you’re not interested in the values they produce; instead, you want to execute these effects and discard the results. This is where the <code dir="auto">Stream.drain</code> function comes into play.</p>
<p>Let’s go through a few examples:</p>
<p><strong>Example 1: Discarding Values</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// We create a stream and immediately drain it.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">drain</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s1))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;// We create a stream and immediately drain it.const s1 = Stream.range(1, 5).pipe(Stream.drain);Effect.runPromise(Stream.runCollect(s1)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [] }*/"><div></div></button></div></figure></div>
<p>In this example, we have a stream with values from 1 to 5, but we use <code dir="auto">Stream.drain</code> to discard these values. As a result, the output stream is empty.</p>
<p><strong>Example 2: Executing Random Effects</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect, Random } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">repeatEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">gen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">function* </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">nextInt</span><span style="--0:#C792EA;--1:#8D46B4"> = yield* </span><span style="--0:#D6DEEB;--1:#403F53">Random</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">nextInt</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">number</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">abs</span><span style="--0:#D6DEEB;--1:#403F53">(nextInt</span><span style="--0:#C792EA;--1:#8D46B4"> % </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">random number: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">number</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">return </span><span style="--0:#D6DEEB;--1:#403F53">number</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s2))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 7</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 7, 5, 0 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s3</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">drain</span><span style="--0:#D6DEEB;--1:#403F53">(s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s3))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 0</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">random number: 7</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect, Random } from &#x22;effect&#x22;;const s2 = Stream.repeatEffect(  Effect.gen(function* () {    const nextInt = yield* Random.nextInt;    const number = Math.abs(nextInt % 10);    console.log(&#x60;random number: ${number}&#x60;);    return number;  })).pipe(Stream.take(3));Effect.runPromise(Stream.runCollect(s2)).then(console.log);/*Example Output:random number: 7random number: 5random number: 0{ _id: &#x27;Chunk&#x27;, values: [ 7, 5, 0 ] }*/const s3 = Stream.drain(s2);Effect.runPromise(Stream.runCollect(s3)).then(console.log);/*Example Output:random number: 0random number: 1random number: 7{ _id: &#x27;Chunk&#x27;, values: [] }*/"><div></div></button></div></figure></div>
<p>In this example, we create a stream with random effects and collect the values of these effects initially. Later, we use <code dir="auto">Stream.drain</code> to execute the same effects without collecting the values. This demonstrates how you can use draining to trigger effectful operations when you’re not interested in the emitted values.</p>
<p>Stream draining can be particularly useful when you need to perform certain actions or cleanup tasks in your application without affecting the main stream of data.</p>
<h2 id="detecting-changes-in-a-stream">Detecting Changes in a Stream</h2>
<p>In this section, we’ll explore the <code dir="auto">Stream.changes</code> operation, which allows you to detect and emit elements that are different from their preceding elements within the stream.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">changes</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 2, 3, 4 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 1, 1, 2, 2, 3, 4).pipe(Stream.changes);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 2, 3, 4 ] }*/"><div></div></button></div></figure></div>
<h2 id="zipping">Zipping</h2>
<p>Zipping is a process of combining two or more streams to create a new stream by pairing elements from the input streams. We can achieve this using the <code dir="auto">Stream.zip</code> and <code dir="auto">Stream.zipWith</code> operators. Let’s dive into some examples:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// We create two streams and zip them together.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zip</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">c</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s1))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ [ 1, 'a' ], [ 2, 'b' ], [ 3, 'c' ] ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#5E6578">// We create two streams and zip them with custom logic.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipWith</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">c</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [n </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#D6DEEB;--1:#403F53"> s</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">length</span><span style="--0:#D6DEEB;--1:#403F53">, s]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s2))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ [ 0, 'a' ], [ 1, 'b' ], [ 2, 'c' ] ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;// We create two streams and zip them together.const s1 = Stream.zip(  Stream.make(1, 2, 3, 4, 5, 6),  Stream.make(&#x22;a&#x22;, &#x22;b&#x22;, &#x22;c&#x22;));Effect.runPromise(Stream.runCollect(s1)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ [ 1, &#x27;a&#x27; ], [ 2, &#x27;b&#x27; ], [ 3, &#x27;c&#x27; ] ] }*/// We create two streams and zip them with custom logic.const s2 = Stream.zipWith(  Stream.make(1, 2, 3, 4, 5, 6),  Stream.make(&#x22;a&#x22;, &#x22;b&#x22;, &#x22;c&#x22;),  (n, s) => [n - s.length, s]);Effect.runPromise(Stream.runCollect(s2)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ [ 0, &#x27;a&#x27; ], [ 1, &#x27;b&#x27; ], [ 2, &#x27;c&#x27; ] ] }*/"><div></div></button></div></figure></div>
<p>The new stream will end when one of the streams ends.</p>
<h3 id="handling-stream-endings">Handling Stream Endings</h3>
<p>When one of the input streams ends before the other, you might need to zip with default values. The <code dir="auto">Stream.zipAll</code> and <code dir="auto">Stream.zipAllWith</code> operations allow you to specify default values for both sides to handle such scenarios. Let’s see an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipAll</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">other: </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">c</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">defaultSelf: </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">defaultOther: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">x</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s1))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 3, 'c' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 4, 'x' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 5, 'x' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 6, 'x' ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipAllWith</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">other: </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">c</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">onSelf</span><span style="--0:#C792EA;--1:#8D46B4">: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [n, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">x</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">onOther</span><span style="--0:#C792EA;--1:#8D46B4">: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, s]</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">onBoth</span><span style="--0:#C792EA;--1:#8D46B4">: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [n </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#D6DEEB;--1:#403F53"> s</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">length</span><span style="--0:#D6DEEB;--1:#403F53">, s]</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s2))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 0, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'c' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 4, 'x' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 5, 'x' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 6, 'x' ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.zipAll(Stream.make(1, 2, 3, 4, 5, 6), {  other: Stream.make(&#x22;a&#x22;, &#x22;b&#x22;, &#x22;c&#x22;),  defaultSelf: 0,  defaultOther: &#x22;x&#x22;,});Effect.runPromise(Stream.runCollect(s1)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ 1, &#x27;a&#x27; ],    [ 2, &#x27;b&#x27; ],    [ 3, &#x27;c&#x27; ],    [ 4, &#x27;x&#x27; ],    [ 5, &#x27;x&#x27; ],    [ 6, &#x27;x&#x27; ]  ]}*/const s2 = Stream.zipAllWith(Stream.make(1, 2, 3, 4, 5, 6), {  other: Stream.make(&#x22;a&#x22;, &#x22;b&#x22;, &#x22;c&#x22;),  onSelf: (n) => [n, &#x22;x&#x22;],  onOther: (s) => [0, s],  onBoth: (n, s) => [n - s.length, s],});Effect.runPromise(Stream.runCollect(s2)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ 0, &#x27;a&#x27; ],    [ 1, &#x27;b&#x27; ],    [ 2, &#x27;c&#x27; ],    [ 4, &#x27;x&#x27; ],    [ 5, &#x27;x&#x27; ],    [ 6, &#x27;x&#x27; ]  ]}*/"><div></div></button></div></figure></div>
<p>This allows you to handle zipping when one stream completes earlier than the other.</p>
<h3 id="zipping-streams-at-different-rates">Zipping Streams at Different Rates</h3>
<p>Sometimes, you might have two streams producing elements at different speeds. If you don’t want to wait for the slower one when zipping elements, you can use <code dir="auto">Stream.zipLatest</code> or <code dir="auto">Stream.zipLatestWith</code>. These operations combine elements in a way that when a value is emitted by either of the two streams, it is combined with the latest value from the other stream to produce a result. Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Schedule, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1 second</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">c</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">d</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">500 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipLatest</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'c' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'd' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 3, 'd' ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Schedule, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3).pipe(  Stream.schedule(Schedule.spaced(&#x22;1 second&#x22;)));const s2 = Stream.make(&#x22;a&#x22;, &#x22;b&#x22;, &#x22;c&#x22;, &#x22;d&#x22;).pipe(  Stream.schedule(Schedule.spaced(&#x22;500 millis&#x22;)));const stream = Stream.zipLatest(s1, s2);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ 1, &#x27;a&#x27; ],    [ 1, &#x27;b&#x27; ],    [ 2, &#x27;b&#x27; ],    [ 2, &#x27;c&#x27; ],    [ 2, &#x27;d&#x27; ],    [ 3, &#x27;d&#x27; ]  ]}*/"><div></div></button></div></figure></div>
<p>Here, <code dir="auto">Stream.zipLatest</code> combines elements from both streams without waiting for the slower one, resulting in a more responsive output.</p>
<h3 id="pairing-with-previous-and-next-elements">Pairing with Previous and Next Elements</h3>
<ul>
<li>
<p><code dir="auto">zipWithPrevious</code>: This operator pairs each element of a stream with its previous element.</p>
</li>
<li>
<p><code dir="auto">zipWithNext</code>: It pairs each element of a stream with its next element.</p>
</li>
<li>
<p><code dir="auto">zipWithPreviousAndNext</code>: This operator pairs each element with both its previous and next elements.</p>
</li>
</ul>
<p>Here’s an example illustrating these operations:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipWithPrevious</span><span style="--0:#D6DEEB;--1:#403F53">(stream);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipWithNext</span><span style="--0:#D6DEEB;--1:#403F53">(stream);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s3</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipWithPreviousAndNext</span><span style="--0:#D6DEEB;--1:#403F53">(stream);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s1))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunks</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">%o</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, chunks)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ { _id: 'Option', _tag: 'None' }, 1, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ { _id: 'Option', _tag: 'Some', value: 1 }, 2, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ { _id: 'Option', _tag: 'Some', value: 2 }, 3, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ { _id: 'Option', _tag: 'Some', value: 3 }, 4, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[length]: 4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s2))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunks</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">%o</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, chunks)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, { _id: 'Option', _tag: 'Some', value: 2 }, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, { _id: 'Option', _tag: 'Some', value: 3 }, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 3, { _id: 'Option', _tag: 'Some', value: 4 }, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 4, { _id: 'Option', _tag: 'None' }, [length]: 2 ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[length]: 4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(s3))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunks</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">%o</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, chunks)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'None' },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">1,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 2 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">[length]: 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 1 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">2,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 3 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">[length]: 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 2 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 4 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">[length]: 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'Some', value: 3 },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">4,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Option', _tag: 'None' },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">[length]: 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[length]: 4</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3, 4);const s1 = Stream.zipWithPrevious(stream);const s2 = Stream.zipWithNext(stream);const s3 = Stream.zipWithPreviousAndNext(stream);Effect.runPromise(Stream.runCollect(s1)).then((chunks) =>  console.log(&#x22;%o&#x22;, chunks));/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ { _id: &#x27;Option&#x27;, _tag: &#x27;None&#x27; }, 1, [length]: 2 ],    [ { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 1 }, 2, [length]: 2 ],    [ { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 2 }, 3, [length]: 2 ],    [ { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 3 }, 4, [length]: 2 ],    [length]: 4  ]}*/Effect.runPromise(Stream.runCollect(s2)).then((chunks) =>  console.log(&#x22;%o&#x22;, chunks));/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ 1, { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 2 }, [length]: 2 ],    [ 2, { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 3 }, [length]: 2 ],    [ 3, { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 4 }, [length]: 2 ],    [ 4, { _id: &#x27;Option&#x27;, _tag: &#x27;None&#x27; }, [length]: 2 ],    [length]: 4  ]}*/Effect.runPromise(Stream.runCollect(s3)).then((chunks) =>  console.log(&#x22;%o&#x22;, chunks));/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [      { _id: &#x27;Option&#x27;, _tag: &#x27;None&#x27; },      1,      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 2 },      [length]: 3    ],    [      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 1 },      2,      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 3 },      [length]: 3    ],    [      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 2 },      3,      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 4 },      [length]: 3    ],    [      { _id: &#x27;Option&#x27;, _tag: &#x27;Some&#x27;, value: 3 },      4,      { _id: &#x27;Option&#x27;, _tag: &#x27;None&#x27; },      [length]: 3    ],    [length]: 4  ]}*/"><div></div></button></div></figure></div>
<h3 id="indexing-stream-elements">Indexing Stream Elements</h3>
<p>Another handy operator is <code dir="auto">Stream.zipWithIndex</code>, which indexes each element of a stream by pairing it with its respective index. This is especially useful when you need to keep track of the position of elements within the stream.</p>
<p>Here’s an example of indexing elements in a stream:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Mary</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">James</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Robert</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Patricia</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">indexedStream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zipWithIndex</span><span style="--0:#D6DEEB;--1:#403F53">(stream);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(indexedStream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [ [ 'Mary', 0 ], [ 'James', 1 ], [ 'Robert', 2 ], [ 'Patricia', 3 ] ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(&#x22;Mary&#x22;, &#x22;James&#x22;, &#x22;Robert&#x22;, &#x22;Patricia&#x22;);const indexedStream = Stream.zipWithIndex(stream);Effect.runPromise(Stream.runCollect(indexedStream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [ [ &#x27;Mary&#x27;, 0 ], [ &#x27;James&#x27;, 1 ], [ &#x27;Robert&#x27;, 2 ], [ &#x27;Patricia&#x27;, 3 ] ]}*/"><div></div></button></div></figure></div>
<h2 id="cartesian-product-of-streams">Cartesian Product of Streams</h2>
<p>The Stream module introduces a powerful feature: the ability to compute the <em>Cartesian Product</em> of two streams. This operation allows you to generate combinations of elements from two separate streams. Let’s explore this concept further:</p>
<p>Imagine you have two sets of items, and you want to generate all possible pairs by taking one item from each set. This process is known as finding the Cartesian Product of the sets. In the context of streams, it means creating combinations of elements from two streams.</p>
<p>To achieve this, the Stream module provides the <code dir="auto">Stream.cross</code> operator, along with its variants. These operators take two streams and generate a new stream containing all possible combinations of elements from the original streams.</p>
<p>Here’s a practical example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">a</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">b</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">product</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">cross</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(product))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 1, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 2, 'b' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 3, 'a' ],</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[ 3, 'b' ]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3);const s2 = Stream.make(&#x22;a&#x22;, &#x22;b&#x22;);const product = Stream.cross(s1, s2);Effect.runPromise(Stream.runCollect(product)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    [ 1, &#x27;a&#x27; ],    [ 1, &#x27;b&#x27; ],    [ 2, &#x27;a&#x27; ],    [ 2, &#x27;b&#x27; ],    [ 3, &#x27;a&#x27; ],    [ 3, &#x27;b&#x27; ]  ]}*/"><div></div></button></div></figure></div>
<p>It’s important to note that the right-hand side stream (<code dir="auto">s2</code> in this case) will be iterated multiple times, once for each element in the left-hand side stream (<code dir="auto">s1</code>). This means that if the right-hand side stream involves expensive or side-effectful operations, they will be executed multiple times.</p>
<h2 id="partitioning">Partitioning</h2>
<p>Partitioning a stream means dividing it into two separate streams based on a specified condition. The Stream module provides two helpful functions for achieving this: <code dir="auto">Stream.partition</code> and <code dir="auto">Stream.partitionEither</code>. Let’s explore how these functions work and when to use them.</p>
<h3 id="partition">partition</h3>
<p>The <code dir="auto">Stream.partition</code> function takes a predicate as input and splits the original stream into two substreams: one containing elements that satisfy the predicate (evaluate to <code dir="auto">true</code>), and the other containing elements that do not (evaluate to <code dir="auto">false</code>). Additionally, these substreams are wrapped within a <code dir="auto">Scope</code> type.</p>
<p>Here’s an example where we partition a stream of numbers into even and odd numbers:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">partition</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">9</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">partition</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#C792EA;--1:#8D46B4"> % </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4"> === </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, { bufferSize: </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4"> }</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">scoped</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">gen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">function*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">evens</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">odds</span><span style="--0:#C792EA;--1:#8D46B4">] = yield* </span><span style="--0:#D6DEEB;--1:#403F53">partition;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">yield*</span><span style="--0:#D6DEEB;--1:#403F53"> Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(evens));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">yield*</span><span style="--0:#D6DEEB;--1:#403F53"> Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(odds));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 2, 4, 6, 8 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 3, 5, 7, 9 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const partition = Stream.range(1, 9).pipe(  Stream.partition((n) => n % 2 === 0, { bufferSize: 5 }));Effect.runPromise(  Effect.scoped(    Effect.gen(function* () {      const [evens, odds] = yield* partition;      console.log(yield* Stream.runCollect(evens));      console.log(yield* Stream.runCollect(odds));    })  ));/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 2, 4, 6, 8 ] }{ _id: &#x27;Chunk&#x27;, values: [ 1, 3, 5, 7, 9 ] }*/"><div></div></button></div></figure></div>
<p>In this example, we use the <code dir="auto">Stream.partition</code> function with a predicate to split the stream into even and odd numbers. The <code dir="auto">bufferSize</code> option controls how much the faster stream can advance beyond the slower one.</p>
<h3 id="partitioneither">partitionEither</h3>
<p>Sometimes, you may need to partition a stream using an effectful predicate. For such cases, the <code dir="auto">Stream.partitionEither</code> function is available. This function accepts an effectful predicate and divides the stream into two substreams based on the result of the predicate: elements that yield <code dir="auto">Either.left</code> values go to one substream, while elements yielding <code dir="auto">Either.right</code> values go to the other.</p>
<p>Here’s an example where we use <code dir="auto">Stream.partitionEither</code> to partition a stream of numbers based on an effectful condition:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect, Either } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">partition</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">9</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">partitionEither</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">succeed</span><span style="--0:#D6DEEB;--1:#403F53">(n</span><span style="--0:#C792EA;--1:#8D46B4"> % </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4"> === </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4"> ? </span><span style="--0:#D6DEEB;--1:#403F53">Either</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">left</span><span style="--0:#D6DEEB;--1:#403F53">(n)</span><span style="--0:#C792EA;--1:#8D46B4"> : </span><span style="--0:#D6DEEB;--1:#403F53">Either</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">right</span><span style="--0:#D6DEEB;--1:#403F53">(n))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">{ bufferSize: </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4"> }</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">scoped</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">gen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">function*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8D46B4">const [</span><span style="--0:#82AAFF;--1:#3C63B3">evens</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">odds</span><span style="--0:#C792EA;--1:#8D46B4">] = yield* </span><span style="--0:#D6DEEB;--1:#403F53">partition;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">yield*</span><span style="--0:#D6DEEB;--1:#403F53"> Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(evens));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">yield*</span><span style="--0:#D6DEEB;--1:#403F53"> Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(odds));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">})</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 2, 4, 6, 8 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 3, 5, 7, 9 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect, Either } from &#x22;effect&#x22;;const partition = Stream.range(1, 9).pipe(  Stream.partitionEither(    (n) => Effect.succeed(n % 2 === 0 ? Either.left(n) : Either.right(n)),    { bufferSize: 5 }  ));Effect.runPromise(  Effect.scoped(    Effect.gen(function* () {      const [evens, odds] = yield* partition;      console.log(yield* Stream.runCollect(evens));      console.log(yield* Stream.runCollect(odds));    })  ));/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 2, 4, 6, 8 ] }{ _id: &#x27;Chunk&#x27;, values: [ 1, 3, 5, 7, 9 ] }*/"><div></div></button></div></figure></div>
<p>In this case, the <code dir="auto">Stream.partitionEither</code> function splits the stream into two substreams: one containing values that are less than 5 (doubled using <code dir="auto">Either.left</code>), and the other containing values greater than or equal to 5 (using <code dir="auto">Either.right</code>).</p>
<h2 id="groupby">GroupBy</h2>
<p>When working with streams of data, you may often need to group elements based on certain criteria. The Stream module provides two functions for achieving this: <code dir="auto">groupByKey</code> and <code dir="auto">groupBy</code>. Let’s explore how these functions work and when to use them.</p>
<h3 id="groupbykey">groupByKey</h3>
<p>The <code dir="auto">Stream.groupByKey</code> function allows you to partition a stream by a simple function of type <code dir="auto">(a: A) => K</code>, where <code dir="auto">A</code> represents the type of elements in your stream, and <code dir="auto">K</code> represents the keys by which the stream should be partitioned.
This function is not effectful, it simply groups elements by applying the provided function.</p>
<p>The <code dir="auto">Stream.groupByKey</code> function returns a new data type called <code dir="auto">GroupBy</code>.
This <code dir="auto">GroupBy</code> type represents a grouped stream.
To work with the groups, you can use the <code dir="auto">GroupBy.evaluate</code> function, which takes a function of type <code dir="auto">(key: K, stream: Stream&#x3C;V, E>) => Stream.Stream&#x3C;...></code>. This function runs across all groups and merges them in a non-deterministic fashion.</p>
<p>In the example below, we use <code dir="auto">groupByKey</code> to group exam results by the tens place of their scores and count the number of results in each group:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, GroupBy, Effect, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">class</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Exam</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">constructor</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#C792EA;--1:#8D46B4">readonly</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">person</span></span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C792EA;--1:#8D46B4">readonly</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">score</span></span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3C63B3">number</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">examResults</span><span style="--0:#C792EA;--1:#8D46B4"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">Exam</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Alex</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">64</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">Exam</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Michael</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">97</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">Exam</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Bill</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">77</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">Exam</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">John</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">78</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">Exam</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Bobby</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">71</span><span style="--0:#D6DEEB;--1:#403F53">),</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">groupByKeyResult</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromIterable</span><span style="--0:#D6DEEB;--1:#403F53">(examResults)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">groupByKey</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">exam</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">floor</span><span style="--0:#D6DEEB;--1:#403F53">(exam</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">score</span><span style="--0:#C792EA;--1:#8D46B4"> / </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4"> * </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">GroupBy</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">evaluate</span><span style="--0:#D6DEEB;--1:#403F53">(groupByKeyResult</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">key</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">stream</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">andThen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunk</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [key, Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53">(chunk)]</span><span style="--0:#C792EA;--1:#8D46B4"> as const</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ [ 60, 1 ], [ 90, 1 ], [ 70, 3 ] ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, GroupBy, Effect, Chunk } from &#x22;effect&#x22;;class Exam {  constructor(readonly person: string, readonly score: number) {}}const examResults = [  new Exam(&#x22;Alex&#x22;, 64),  new Exam(&#x22;Michael&#x22;, 97),  new Exam(&#x22;Bill&#x22;, 77),  new Exam(&#x22;John&#x22;, 78),  new Exam(&#x22;Bobby&#x22;, 71),];const groupByKeyResult = Stream.fromIterable(examResults).pipe(  Stream.groupByKey((exam) => Math.floor(exam.score / 10) * 10));const stream = GroupBy.evaluate(groupByKeyResult, (key, stream) =>  Stream.fromEffect(    Stream.runCollect(stream).pipe(      Effect.andThen((chunk) => [key, Chunk.size(chunk)] as const)    )  ));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ [ 60, 1 ], [ 90, 1 ], [ 70, 3 ] ] }*/"><div></div></button></div></figure></div>
<p>In this example, we partition the exam results into groups based on the tens place of their scores (e.g., 60, 90, 70). The <code dir="auto">groupByKey</code> function is ideal for simple, non-effectful partitioning.</p>
<h3 id="groupby-1">groupBy</h3>
<p>In more complex scenarios where partitioning involves effects, you can turn to the <code dir="auto">Stream.groupBy</code> function. This function takes an effectful partitioning function and generates a <code dir="auto">GroupBy</code> data type, representing a grouped stream. You can then use <code dir="auto">GroupBy.evaluate</code> in a similar fashion as before to process the groups.</p>
<p>In the following example, we group names by their first character and count the number of names in each group. Note that the partitioning operation itself is simulated as effectful:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, GroupBy, Effect, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">groupByKeyResult</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromIterable</span><span style="--0:#D6DEEB;--1:#403F53">([</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Mary</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">James</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Robert</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Patricia</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">John</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Jennifer</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Rebecca</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">Peter</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">])</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">groupBy</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">name</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">succeed</span><span style="--0:#D6DEEB;--1:#403F53">([name</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">substring</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">), name])));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">GroupBy</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">evaluate</span><span style="--0:#D6DEEB;--1:#403F53">(groupByKeyResult</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">key</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">stream</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromEffect</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">andThen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunk</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span><span style="--0:#D6DEEB;--1:#403F53"> [key, Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">size</span><span style="--0:#D6DEEB;--1:#403F53">(chunk)]</span><span style="--0:#C792EA;--1:#8D46B4"> as const</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [ [ 'M', 1 ], [ 'J', 3 ], [ 'R', 2 ], [ 'P', 2 ] ]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, GroupBy, Effect, Chunk } from &#x22;effect&#x22;;const groupByKeyResult = Stream.fromIterable([  &#x22;Mary&#x22;,  &#x22;James&#x22;,  &#x22;Robert&#x22;,  &#x22;Patricia&#x22;,  &#x22;John&#x22;,  &#x22;Jennifer&#x22;,  &#x22;Rebecca&#x22;,  &#x22;Peter&#x22;,]).pipe(Stream.groupBy((name) => Effect.succeed([name.substring(0, 1), name])));const stream = GroupBy.evaluate(groupByKeyResult, (key, stream) =>  Stream.fromEffect(    Stream.runCollect(stream).pipe(      Effect.andThen((chunk) => [key, Chunk.size(chunk)] as const)    )  ));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [ [ &#x27;M&#x27;, 1 ], [ &#x27;J&#x27;, 3 ], [ &#x27;R&#x27;, 2 ], [ &#x27;P&#x27;, 2 ] ]}*/"><div></div></button></div></figure></div>
<h2 id="grouping">Grouping</h2>
<p>When working with streams, you may encounter situations where you need to group elements in a more structured manner. The Stream module provides two helpful functions for achieving this: <code dir="auto">grouped</code> and <code dir="auto">groupedWithin</code>. In this section, we’ll explore how these functions work and when to use them.</p>
<h3 id="grouped">grouped</h3>
<p>The <code dir="auto">Stream.grouped</code> function is perfect for partitioning stream results into chunks of a specified size. It’s especially useful when you want to work with data in smaller, more manageable pieces.</p>
<p>Here’s an example that demonstrates the use of <code dir="auto">Stream.grouped</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">grouped</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunks</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">%o</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, chunks)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 2, [length]: 3 ] },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 3, 4, 5, [length]: 3 ] },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 6, 7, 8, [length]: 3 ] },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">[length]: 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.range(0, 8).pipe(Stream.grouped(3));Effect.runPromise(Stream.runCollect(stream)).then((chunks) =>  console.log(&#x22;%o&#x22;, chunks));/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    { _id: &#x27;Chunk&#x27;, values: [ 0, 1, 2, [length]: 3 ] },    { _id: &#x27;Chunk&#x27;, values: [ 3, 4, 5, [length]: 3 ] },    { _id: &#x27;Chunk&#x27;, values: [ 6, 7, 8, [length]: 3 ] },    [length]: 3  ]}*/"><div></div></button></div></figure></div>
<p>In this example, we take a stream of numbers from 0 to 9 and use <code dir="auto">Stream.grouped(3)</code> to divide it into chunks of size 3.</p>
<h3 id="groupedwithin">groupedWithin</h3>
<p>The <code dir="auto">Stream.groupedWithin</code> function provides more flexibility by allowing you to group events based on time intervals or chunk size, whichever condition is satisfied first. This is particularly useful when you want to group data based on time constraints.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Schedule, Effect, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">9</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">repeat</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1 second</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">groupedWithin</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">18</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1.5 seconds</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">chunks</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">toArray</span><span style="--0:#D6DEEB;--1:#403F53">(chunks))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">[</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">0, 1, 2, 3, 4, 5, 6,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">7, 8, 9, 0, 1, 2, 3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">4, 5, 6, 7</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">8, 9, 0, 1, 2,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">3, 4, 5, 6, 7,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">8, 9</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">0, 1, 2, 3, 4, 5, 6,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">7, 8, 9, 0, 1, 2, 3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">      </span></span><span style="--0:#809191;--1:#616671">4, 5, 6, 7</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Schedule, Effect, Chunk } from &#x22;effect&#x22;;const stream = Stream.range(0, 9).pipe(  Stream.repeat(Schedule.spaced(&#x22;1 second&#x22;)),  Stream.groupedWithin(18, &#x22;1.5 seconds&#x22;),  Stream.take(3));Effect.runPromise(Stream.runCollect(stream)).then((chunks) =>  console.log(Chunk.toArray(chunks)));/*Output:[  {    _id: &#x27;Chunk&#x27;,    values: [      0, 1, 2, 3, 4, 5, 6,      7, 8, 9, 0, 1, 2, 3,      4, 5, 6, 7    ]  },  {    _id: &#x27;Chunk&#x27;,    values: [      8, 9, 0, 1, 2,      3, 4, 5, 6, 7,      8, 9    ]  },  {    _id: &#x27;Chunk&#x27;,    values: [      0, 1, 2, 3, 4, 5, 6,      7, 8, 9, 0, 1, 2, 3,      4, 5, 6, 7    ]  }]*/"><div></div></button></div></figure></div>
<p>In this example, we use <code dir="auto">Stream.groupedWithin(18, "1.5 seconds")</code> to create chunks of data. The grouping operation occurs either when 18 elements are reached or when 1.5 seconds have passed since the last chunk was created. This is particularly useful when dealing with time-sensitive data or when you want to control the chunk size dynamically.</p>
<h2 id="concatenation">Concatenation</h2>
<p>In stream processing, there are scenarios where you may want to combine the contents of multiple streams. The Stream module provides several operators for achieving this, including <code dir="auto">Stream.concat</code>, <code dir="auto">Stream.concatAll</code>, and <code dir="auto">Stream.flatMap</code>. Let’s explore these operators and understand how to use them effectively.</p>
<h3 id="simple-concatenation">Simple Concatenation</h3>
<p>The <code dir="auto">Stream.concat</code> operator is a straightforward way to concatenate two streams. It returns a new stream that emits elements from the left-hand stream followed by elements from the right-hand stream. This is useful when you want to combine two streams in a sequential manner.</p>
<p>Here’s an example of using <code dir="auto">Stream.concat</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 2, 3, 4, 5 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3);const s2 = Stream.make(4, 5);const stream = Stream.concat(s1, s2);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 2, 3, 4, 5 ] }*/"><div></div></button></div></figure></div>
<h3 id="concatenating-multiple-streams">Concatenating Multiple Streams</h3>
<p>Sometimes you may have multiple streams that you want to concatenate together. Instead of manually chaining <code dir="auto">Stream.concat</code> operations, you can use <code dir="auto">Stream.concatAll</code> to concatenate a <code dir="auto">Chunk</code> of streams.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s3</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">7</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concatAll</span><span style="--0:#D6DEEB;--1:#403F53">(Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s3));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">1, 2, 3, 4,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">5, 6, 7, 8</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect, Chunk } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3);const s2 = Stream.make(4, 5);const s3 = Stream.make(6, 7, 8);const stream = Stream.concatAll(Chunk.make(s1, s2, s3));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    1, 2, 3, 4,    5, 6, 7, 8  ]}*/"><div></div></button></div></figure></div>
<h3 id="advanced-concatenation-with-flatmap">Advanced Concatenation with flatMap</h3>
<p>The <code dir="auto">Stream.flatMap</code> operator allows you to create a stream whose elements are generated by applying a function of type <code dir="auto">(a: A) => Stream&#x3C;...></code> to each output of the source stream. It concatenates all of the results.</p>
<p>Here’s an example of using <code dir="auto">Stream.flatMap</code>:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">flatMap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">a</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">repeatValue</span><span style="--0:#D6DEEB;--1:#403F53">(a)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">)))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">1, 1, 1, 1, 2,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">2, 2, 2, 3, 3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">3, 3</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3).pipe(  Stream.flatMap((a) => Stream.repeatValue(a).pipe(Stream.take(4))));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    1, 1, 1, 1, 2,    2, 2, 2, 3, 3,    3, 3  ]}*/"><div></div></button></div></figure></div>
<p>If we need to do the <code dir="auto">flatMap</code> concurrently, we can use the <code dir="auto">concurrency</code> option, and also if the order of concatenation is not important for us, we can use the <code dir="auto">switch</code> option.</p>
<h2 id="merging">Merging</h2>
<p>Sometimes we need to interleave the emission of two streams and create another stream. In these cases, we can’t use the <code dir="auto">Stream.concat</code> operation because the concat operation waits for the first stream to finish and then consumes the second stream. So we need a way of picking elements from different sources. Effect Stream’s merge operations does this for us. Let’s discuss some variants of this operation:</p>
<h3 id="merge">merge</h3>
<p>The <code dir="auto">Stream.merge</code> operation allows us to pick elements from different source streams and merge them into a single stream. Unlike <code dir="auto">Stream.concat</code>, which waits for the first stream to finish before moving to the second, <code dir="auto">Stream.merge</code> interleaves elements from both streams as they become available.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Schedule, Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">200 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">merge</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 4, 2, 3, 5, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Schedule, Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3).pipe(  Stream.schedule(Schedule.spaced(&#x22;100 millis&#x22;)));const s2 = Stream.make(4, 5, 6).pipe(  Stream.schedule(Schedule.spaced(&#x22;200 millis&#x22;)));const stream = Stream.merge(s1, s2);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 4, 2, 3, 5, 6 ] }*/"><div></div></button></div></figure></div>
<h3 id="termination-strategy">Termination Strategy</h3>
<p>When merging two streams, we should consider their termination strategy. Each stream has its own lifetime, some may finish quickly, while others may continue indefinitely. By default, when using <code dir="auto">Stream.merge</code>, the resulting stream terminates only when both specified streams terminate.</p>
<p>However, you can define the termination strategy to align with your requirements. Stream offers four different termination strategies using the <code dir="auto">haltStrategy</code> option:</p>
<ul>
<li><code dir="auto">"left"</code>. The resulting stream will terminate when the left-hand side stream terminates.</li>
<li><code dir="auto">"right"</code>. The resulting stream will terminate when the right-hand side stream finishes.</li>
<li><code dir="auto">"both"</code>. The resulting stream will terminate when both streams finish.</li>
<li><code dir="auto">"either"</code>. The resulting stream will terminate when one of the streams finishes.</li>
</ul>
<p>Here’s an example of specifying a termination strategy:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Schedule, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">repeatValue</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">200 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">merge</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2</span><span style="--0:#C792EA;--1:#8D46B4">, { haltStrategy: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">left</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4"> }</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">1, 0, 2, 3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">0, 4, 5</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Schedule, Effect } from &#x22;effect&#x22;;const s1 = Stream.range(1, 5).pipe(  Stream.schedule(Schedule.spaced(&#x22;100 millis&#x22;)));const s2 = Stream.repeatValue(0).pipe(  Stream.schedule(Schedule.spaced(&#x22;200 millis&#x22;)));const stream = Stream.merge(s1, s2, { haltStrategy: &#x22;left&#x22; });Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    1, 0, 2, 3,    0, 4, 5  ]}*/"><div></div></button></div></figure></div>
<p>In this example, we use <code dir="auto">haltStrategy: "left"</code> to make the resulting stream terminate when the left-hand stream (<code dir="auto">s1</code>) finishes.</p>
<h3 id="mergewith">mergeWith</h3>
<p>In some cases, we not only want to merge two streams but also transform and unify their elements into new types. This is where <code dir="auto">Stream.mergeWith</code> comes into play. It allows us to specify transformation functions for both source streams.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Schedule, Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">2</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">3</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4.1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5.3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6.2</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">200 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">mergeWith</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2</span><span style="--0:#C792EA;--1:#8D46B4">, {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">onSelf</span><span style="--0:#C792EA;--1:#8D46B4">: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">parseInt</span><span style="--0:#D6DEEB;--1:#403F53">(s)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">onOther</span><span style="--0:#C792EA;--1:#8D46B4">: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">floor</span><span style="--0:#D6DEEB;--1:#403F53">(n)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 4, 2, 3, 5, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Schedule, Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(&#x22;1&#x22;, &#x22;2&#x22;, &#x22;3&#x22;).pipe(  Stream.schedule(Schedule.spaced(&#x22;100 millis&#x22;)));const s2 = Stream.make(4.1, 5.3, 6.2).pipe(  Stream.schedule(Schedule.spaced(&#x22;200 millis&#x22;)));const stream = Stream.mergeWith(s1, s2, {  onSelf: (s) => parseInt(s),  onOther: (n) => Math.floor(n),});Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 4, 2, 3, 5, 6 ] }*/"><div></div></button></div></figure></div>
<p>In this example, we use <code dir="auto">Stream.mergeWith</code> to merge <code dir="auto">s1</code> and <code dir="auto">s2</code> while converting string elements from <code dir="auto">s1</code> to integers and rounding decimal elements from <code dir="auto">s2</code>.</p>
<h2 id="interleaving">Interleaving</h2>
<p>The <code dir="auto">Stream.interleave</code> operator allows us to pull one element at a time from each of two streams, creating a new interleaved stream. Once one of the streams is exhausted, the remaining values from the other stream are pulled.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">interleave</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 4, 2, 5, 3, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 2, 3);const s2 = Stream.make(4, 5, 6);const stream = Stream.interleave(s1, s2);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{ _id: &#x27;Chunk&#x27;, values: [ 1, 4, 2, 5, 3, 6 ] }*/"><div></div></button></div></figure></div>
<p>For more advanced interleaving logic, <code dir="auto">Stream.interleaveWith</code> provides additional flexibility. It allows you to specify the interleaving logic using a third stream of <code dir="auto">boolean</code> values. When the boolean stream emits <code dir="auto">true</code>, it chooses elements from the left-hand stream; otherwise, it selects elements from the right-hand stream.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">7</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">9</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">s2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">booleanStream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#FF5874;--1:#A54A4A">false</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#FF5874;--1:#A54A4A">false</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">forever</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">interleaveWith</span><span style="--0:#D6DEEB;--1:#403F53">(s1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">s2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D6DEEB;--1:#403F53">booleanStream);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">1, 2,  4, 3, 6,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">8, 5, 10, 7, 9</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const s1 = Stream.make(1, 3, 5, 7, 9);const s2 = Stream.make(2, 4, 6, 8, 10);const booleanStream = Stream.make(true, false, false).pipe(Stream.forever);const stream = Stream.interleaveWith(s1, s2, booleanStream);Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    1, 2,  4, 3, 6,    8, 5, 10, 7, 9  ]}*/"><div></div></button></div></figure></div>
<p>In this example, <code dir="auto">booleanStream</code> decides which source stream to choose for interleaving. When <code dir="auto">true</code>, it picks elements from <code dir="auto">s1</code>, and when <code dir="auto">false</code>, it selects elements from <code dir="auto">s2</code>.</p>
<h2 id="interspersing">Interspersing</h2>
<p>Interspersing is a technique that allows you to add separators in a stream. This can be especially useful when you want to format or structure the data in your streams.</p>
<h3 id="intersperse">intersperse</h3>
<p>The <code dir="auto">Stream.intersperse</code> operator lets you intersperse a delimiter element between the elements of a stream. This delimiter can be any value you choose. It’s added between each pair of elements in the original stream.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">intersperse</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">1, 0, 2, 0, 3,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">0, 4, 0, 5</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3, 4, 5).pipe(Stream.intersperse(0));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    1, 0, 2, 0, 3,    0, 4, 0, 5  ]}*/"><div></div></button></div></figure></div>
<p>In this example, we have a stream <code dir="auto">stream</code> with numbers from 1 to 5, and we use <code dir="auto">Stream.intersperse(0)</code> to add zeros between them.</p>
<h3 id="intersperseaffixes">intersperseAffixes</h3>
<p>For more advanced interspersing needs, <code dir="auto">Stream.intersperseAffixes</code> provides greater control. It allows you to specify different affixes for the start, middle, and end of your stream. These affixes can be strings or any other values you want.</p>
<p>Here’s an example:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">intersperseAffixes</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">start: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">middle: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">-</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">end: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">]</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">'[', 1,   '-', 2,   '-',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">3,   '-', 4,   '-', 5,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">']'</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;const stream = Stream.make(1, 2, 3, 4, 5).pipe(  Stream.intersperseAffixes({    start: &#x22;[&#x22;,    middle: &#x22;-&#x22;,    end: &#x22;]&#x22;,  }));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:{  _id: &#x27;Chunk&#x27;,  values: [    &#x27;[&#x27;, 1,   &#x27;-&#x27;, 2,   &#x27;-&#x27;,    3,   &#x27;-&#x27;, 4,   &#x27;-&#x27;, 5,    &#x27;]&#x27;  ]}*/"><div></div></button></div></figure></div>
<p>In this example, we use <code dir="auto">Stream.intersperseAffixes</code> to enclose the numbers from 1 to 5 within square brackets, separating them with hyphens.</p>
<h2 id="broadcasting">Broadcasting</h2>
<p>Broadcasting a stream is a way to create multiple streams that contain the same elements as the source stream. This operation allows you to send each element to multiple downstream streams simultaneously. However, the upstream stream can emit events only up to a certain limit, which is determined by the <code dir="auto">maximumLag</code> parameter. Once this limit is reached, the upstream stream slows down to match the speed of the slowest downstream stream.</p>
<p>Let’s take a closer look at how broadcasting works in the following example. Here, we are broadcasting a stream of numbers to two downstream streams. One of them calculates the maximum number in the stream, while the other performs some logging with an additional delay. The upstream stream adjusts its speed based on the slower logging stream:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Effect, Stream, Console, Schedule, Fiber } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">numbers</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">scoped</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">20</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Emit </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> element before broadcasting</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">broadcast</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">flatMap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#C792EA;--1:#8D46B4">[</span><span style="--0:#D7DBE0;--1:#403F53">first</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">second</span><span style="--0:#C792EA;--1:#8D46B4">]</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">gen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">function* </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">        </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fiber1</span><span style="--0:#C792EA;--1:#8D46B4"> = yield* </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runFold</span><span style="--0:#D6DEEB;--1:#403F53">(first</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">acc</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#D7DBE0;--1:#403F53">e</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">max</span><span style="--0:#D6DEEB;--1:#403F53">(acc</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#D6DEEB;--1:#403F53">e)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">andThen</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">max</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Maximum: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">max</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#7690A6;--1:#4F687D">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">fork</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">        </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">fiber2</span><span style="--0:#C792EA;--1:#8D46B4"> = yield* </span><span style="--0:#D6DEEB;--1:#403F53">second</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1 second</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#7690A6;--1:#4F687D">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runForEach</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Logging to the Console: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#7690A6;--1:#4F687D">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">fork</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">        </span></span><span style="--0:#C792EA;--1:#8D46B4">yield* </span><span style="--0:#D6DEEB;--1:#403F53">Fiber</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">(fiber1)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">zip</span><span style="--0:#D6DEEB;--1:#403F53">(Fiber</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">join</span><span style="--0:#D6DEEB;--1:#403F53">(fiber2)</span><span style="--0:#7690A6;--1:#4F687D">,</span><span style="--0:#C792EA;--1:#8D46B4"> { concurrent: </span><span style="--0:#FF5874;--1:#A54A4A">true</span><span style="--0:#C792EA;--1:#8D46B4"> }</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">      </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">runCollect</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(numbers)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 1 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 2 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 3 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 4 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 5 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 6 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 7 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 8 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 9 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 10 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 11 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 12 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 13 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 14 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 15 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 16 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 7</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 9</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 10</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 17 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 18 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 19 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Emit 20 element before broadcasting</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 11</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 12</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 13</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 14</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 15</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Maximum: 20</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 16</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 17</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 18</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 19</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Logging to the Console: 20</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ undefined ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Effect, Stream, Console, Schedule, Fiber } from &#x22;effect&#x22;;const numbers = Effect.scoped(  Stream.range(1, 20).pipe(    Stream.tap((n) => Console.log(&#x60;Emit ${n} element before broadcasting&#x60;)),    Stream.broadcast(2, 5),    Stream.flatMap(([first, second]) =>      Effect.gen(function* () {        const fiber1 = yield* Stream.runFold(first, 0, (acc, e) =>          Math.max(acc, e)        ).pipe(          Effect.andThen((max) => Console.log(&#x60;Maximum: ${max}&#x60;)),          Effect.fork        );        const fiber2 = yield* second.pipe(          Stream.schedule(Schedule.spaced(&#x22;1 second&#x22;)),          Stream.runForEach((n) => Console.log(&#x60;Logging to the Console: ${n}&#x60;)),          Effect.fork        );        yield* Fiber.join(fiber1).pipe(          Effect.zip(Fiber.join(fiber2), { concurrent: true })        );      })    ),    Stream.runCollect  ));Effect.runPromise(numbers).then(console.log);/*Output:Emit 1 element before broadcastingEmit 2 element before broadcastingEmit 3 element before broadcastingEmit 4 element before broadcastingEmit 5 element before broadcastingEmit 6 element before broadcastingEmit 7 element before broadcastingEmit 8 element before broadcastingEmit 9 element before broadcastingEmit 10 element before broadcastingEmit 11 element before broadcastingLogging to the Console: 1Logging to the Console: 2Logging to the Console: 3Logging to the Console: 4Logging to the Console: 5Emit 12 element before broadcastingEmit 13 element before broadcastingEmit 14 element before broadcastingEmit 15 element before broadcastingEmit 16 element before broadcastingLogging to the Console: 6Logging to the Console: 7Logging to the Console: 8Logging to the Console: 9Logging to the Console: 10Emit 17 element before broadcastingEmit 18 element before broadcastingEmit 19 element before broadcastingEmit 20 element before broadcastingLogging to the Console: 11Logging to the Console: 12Logging to the Console: 13Logging to the Console: 14Logging to the Console: 15Maximum: 20Logging to the Console: 16Logging to the Console: 17Logging to the Console: 18Logging to the Console: 19Logging to the Console: 20{ _id: &#x27;Chunk&#x27;, values: [ undefined ] }*/"><div></div></button></div></figure></div>
<h2 id="buffering">Buffering</h2>
<p>Effect streams operate in a pull-based manner, which means downstream consumers can request elements at their own pace without needing to signal the upstream to slow down. However, there are scenarios where you might need to handle producers and consumers independently, especially when there’s a speed mismatch between them. This is where buffering comes into play, allowing you to manage communication between a faster producer and a slower consumer effectively. Effect streams provide a built-in <code dir="auto">Stream.buffer</code> operator to assist with this.</p>
<h3 id="buffer">buffer</h3>
<p>The <code dir="auto">Stream.buffer</code> operator is designed to facilitate scenarios where a faster producer needs to work independently of a slower consumer. It achieves this by buffering elements in a queue, allowing the producer to continue working even if the consumer lags behind. You can specify the maximum buffer capacity using the <code dir="auto">capacity</code> option.</p>
<p>Let’s walk through an example to see how it works:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Console, Schedule, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">range</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">10</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">before buffering: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">buffer</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">{ capacity: </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4"> }</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#D6DEEB;--1:#403F53">Console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">after buffering: </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">5 seconds</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 6</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after buffering: 1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after buffering: 2</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 7</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after buffering: 3</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 8</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after buffering: 4</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 9</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">after buffering: 5</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">before buffering: 10</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Console, Schedule, Effect } from &#x22;effect&#x22;;const stream = Stream.range(1, 10).pipe(  Stream.tap((n) => Console.log(&#x60;before buffering: ${n}&#x60;)),  Stream.buffer({ capacity: 4 }),  Stream.tap((n) => Console.log(&#x60;after buffering: ${n}&#x60;)),  Stream.schedule(Schedule.spaced(&#x22;5 seconds&#x22;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Output:before buffering: 1before buffering: 2before buffering: 3before buffering: 4before buffering: 5before buffering: 6after buffering: 1after buffering: 2before buffering: 7after buffering: 3before buffering: 8after buffering: 4before buffering: 9after buffering: 5before buffering: 10...*/"><div></div></button></div></figure></div>
<p>In this example, we create a stream of numbers from 1 to 11. We use <code dir="auto">Stream.buffer({ capacity: 4 })</code> to buffer up to 4 elements at a time. As you can see, the <code dir="auto">Stream.tap</code> operator allows us to log each element before and after buffering. We’ve also introduced a 5-second delay between each emission to illustrate the lag between producing and consuming messages.</p>
<p>You can choose from different buffering options based on the type of underlying queue you need:</p>
<ul>
<li>Bounded Queue: <code dir="auto">{ capacity: number }</code></li>
<li>Unbounded Queue: <code dir="auto">{ capacity: "unbounded" }</code></li>
<li>Sliding Queue: <code dir="auto">{ capacity: number, strategy: "sliding" }</code></li>
<li>Dropping Queue: <code dir="auto">{ capacity: number, strategy: "dropping" }</code></li>
</ul>
<h2 id="debouncing">Debouncing</h2>
<p>Debouncing in programming is used to ensure that a function doesn’t fire too frequently.
This can be especially useful in scenarios where a stream emits values in rapid succession but you only need to react after a pause in activity.</p>
<p>The <code dir="auto">Stream.debounce</code> function in the Effect library exemplifies this by delaying the emission of stream values.
It waits for a specified duration to pass without any new values before emitting the latest value.
If a new value arrives during this waiting period, the current value is discarded and the timer resets with the new value.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">let </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">message</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">end</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">message</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> after </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">ms</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromEffect</span><span style="--0:#D6DEEB;--1:#403F53">(Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sleep</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">200 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">as</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#D6DEEB;--1:#403F53">)))</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#809191;--1:#5E6578">// Emit 4 after 200 ms</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#809191;--1:#5E6578">// Continue with more rapid values</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromEffect</span><span style="--0:#D6DEEB;--1:#403F53">(Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sleep</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">150 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">as</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">7</span><span style="--0:#D6DEEB;--1:#403F53">)))</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#809191;--1:#5E6578">// Emit 7 after 150 ms</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">8</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Received </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">debounce</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#809191;--1:#5E6578">// Only emit values after a pause of at least 100 milliseconds,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">> Emitted </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 1 after 5ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 2 after 2ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 3 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 3 after 104ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 4 after 99ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 5 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 6 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 6 after 101ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 7 after 50ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 8 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 8 after 101ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 3, 6, 8 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect } from &#x22;effect&#x22;;let last = Date.now();const log = (message: string) =>  Effect.sync(() => {    const end = Date.now();    console.log(&#x60;${message} after ${end - last}ms&#x60;);    last = end;  });const stream = Stream.make(1, 2, 3).pipe(  Stream.concat(    Stream.fromEffect(Effect.sleep(&#x22;200 millis&#x22;).pipe(Effect.as(4))) // Emit 4 after 200 ms  ),  Stream.concat(Stream.make(5, 6)), // Continue with more rapid values  Stream.concat(    Stream.fromEffect(Effect.sleep(&#x22;150 millis&#x22;).pipe(Effect.as(7))) // Emit 7 after 150 ms  ),  Stream.concat(Stream.make(8)),  Stream.tap((n) => log(&#x60;Received ${n}&#x60;)),  Stream.debounce(&#x22;100 millis&#x22;), // Only emit values after a pause of at least 100 milliseconds,  Stream.tap((n) => log(&#x60;> Emitted ${n}&#x60;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Example Output:Received 1 after 5msReceived 2 after 2msReceived 3 after 0ms> Emitted 3 after 104msReceived 4 after 99msReceived 5 after 1msReceived 6 after 0ms> Emitted 6 after 101msReceived 7 after 50msReceived 8 after 1ms> Emitted 8 after 101ms{ _id: &#x27;Chunk&#x27;, values: [ 3, 6, 8 ] }*/"><div></div></button></div></figure></div>
<h2 id="throttling">Throttling</h2>
<p>Throttling is a technique employed to regulate the rate at which elements are emitted from a stream.
It is useful for maintaining a steady pace of data output, which is especially valuable in scenarios where data processing needs to occur at a consistent rate.</p>
<p>The <code dir="auto">Stream.throttle</code> function controls the rate of this stream’s chunks by utilizing the <a href="https://en.wikipedia.org/wiki/Token_bucket">token bucket algorithm</a>.</p>
<p><strong>Example of Throttle Configuration</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">throttle</span><span style="--0:#D6DEEB;--1:#403F53">({</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">cost</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">duration: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">units: </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Stream.throttle({  cost: () => 1,  duration: &#x22;100 millis&#x22;,  units: 1,});"><div></div></button></div></figure></div>
<p>In this configuration:</p>
<ul>
<li>Each chunk processed uses one token (<code dir="auto">cost = () => 1</code>).</li>
<li>Tokens are replenished at a rate of one token (<code dir="auto">units: 1</code>) every 100 milliseconds (<code dir="auto">duration: "100 millis"</code>).</li>
</ul>
<div><p>It’s important to note that throttling operates on chunks rather than
individual elements. The <code dir="auto">cost</code> function determines the token cost for each
chunk.</p></div>
<h3 id="shape-strategy-default">Shape Strategy (Default)</h3>
<p>The “shape” strategy moderates data flow by delaying chunk emissions until they comply with specified bandwidth constraints.
This strategy ensures that data throughput does not exceed defined limits, allowing for steady and controlled data emission.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect, Schedule, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">let </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">message</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">end</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">message</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> after </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">ms</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromSchedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">50 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Received </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">throttle</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">cost: </span><span style="--0:#D6DEEB;--1:#403F53">Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">size</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">duration: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">units: </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">> Emitted </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 0 after 56ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 0 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 1 after 52ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 1 after 48ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 2 after 52ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 2 after 49ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 3 after 52ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 3 after 48ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 4 after 52ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 4 after 47ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 5 after 52ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 5 after 49ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 0, 1, 2, 3, 4, 5 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect, Schedule, Chunk } from &#x22;effect&#x22;;let last = Date.now();const log = (message: string) =>  Effect.sync(() => {    const end = Date.now();    console.log(&#x60;${message} after ${end - last}ms&#x60;);    last = end;  });const stream = Stream.fromSchedule(Schedule.spaced(&#x22;50 millis&#x22;)).pipe(  Stream.take(6),  Stream.tap((n) => log(&#x60;Received ${n}&#x60;)),  Stream.throttle({    cost: Chunk.size,    duration: &#x22;100 millis&#x22;,    units: 1,  }),  Stream.tap((n) => log(&#x60;> Emitted ${n}&#x60;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Example Output:Received 0 after 56ms> Emitted 0 after 0msReceived 1 after 52ms> Emitted 1 after 48msReceived 2 after 52ms> Emitted 2 after 49msReceived 3 after 52ms> Emitted 3 after 48msReceived 4 after 52ms> Emitted 4 after 47msReceived 5 after 52ms> Emitted 5 after 49ms{ _id: &#x27;Chunk&#x27;, values: [ 0, 1, 2, 3, 4, 5 ] }*/"><div></div></button></div></figure></div>
<h3 id="enforce-strategy">Enforce Strategy</h3>
<p>The “enforce” strategy strictly regulates data flow by discarding chunks that exceed bandwidth constraints.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Stream, Effect, Schedule, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">let </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">message</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">end</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">message</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> after </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">ms</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">make</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">4</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--0:#F78C6C;--1:#AA0982">6</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">schedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">exponential</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">100 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Received </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">throttle</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">cost: </span><span style="--0:#D6DEEB;--1:#403F53">Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">size</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">duration: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">1 second</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">units: </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">strategy: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">enforce</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">> Emitted </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 1 after 106ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 1 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 2 after 200ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 3 after 402ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 4 after 801ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 4 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 5 after 1601ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 5 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 6 after 3201ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 6 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{ _id: 'Chunk', values: [ 1, 4, 5, 6 ] }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Stream, Effect, Schedule, Chunk } from &#x22;effect&#x22;;let last = Date.now();const log = (message: string) =>  Effect.sync(() => {    const end = Date.now();    console.log(&#x60;${message} after ${end - last}ms&#x60;);    last = end;  });const stream = Stream.make(1, 2, 3, 4, 5, 6).pipe(  Stream.schedule(Schedule.exponential(&#x22;100 millis&#x22;)),  Stream.tap((n) => log(&#x60;Received ${n}&#x60;)),  Stream.throttle({    cost: Chunk.size,    duration: &#x22;1 second&#x22;,    units: 1,    strategy: &#x22;enforce&#x22;,  }),  Stream.tap((n) => log(&#x60;> Emitted ${n}&#x60;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Example Output:Received 1 after 106ms> Emitted 1 after 1msReceived 2 after 200msReceived 3 after 402msReceived 4 after 801ms> Emitted 4 after 1msReceived 5 after 1601ms> Emitted 5 after 1msReceived 6 after 3201ms> Emitted 6 after 0ms{ _id: &#x27;Chunk&#x27;, values: [ 1, 4, 5, 6 ] }*/"><div></div></button></div></figure></div>
<h3 id="burst-option">burst option</h3>
<p>The <code dir="auto">Stream.throttle</code> function offers a burst option that allows for temporary increases in data throughput beyond the set rate limits.
This option is set to greater than 0 to activate burst capability (default is 0, indicating no burst support).
The burst capacity provides additional tokens in the token bucket, enabling the stream to momentarily exceed its configured rate when bursts of data occur.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { Effect, Schedule, Stream, Chunk } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">effect</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">let </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">message</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#C5E478;--1:#3C63B3">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> =></span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">sync</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8D46B4"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">end</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">now</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">message</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3"> after </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#C792EA;--1:#8D46B4">-</span><span style="--0:#DD6B68;--1:#B73936"> </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#ECC48D;--1:#3C63B3">ms</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#D6DEEB;--1:#403F53">last</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">end</span><span style="--0:#C792EA;--1:#8D46B4">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">stream</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">fromSchedule</span><span style="--0:#D6DEEB;--1:#403F53">(Schedule</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">spaced</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">10 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">pipe</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">take</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">20</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">Received </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">throttle</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8D46B4">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">cost: </span><span style="--0:#D6DEEB;--1:#403F53">Chunk</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">size</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">duration: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">200 millis</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">units: </span><span style="--0:#F78C6C;--1:#AA0982">5</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">strategy: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">enforce</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">    </span></span><span style="--0:#C792EA;--1:#8D46B4">burst: </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8D46B4">  </span></span><span style="--0:#C792EA;--1:#8D46B4">}</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8D46B4">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D6DEEB;--1:#403F53">Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">tap</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">n</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#C792EA;--1:#8D46B4"> => </span><span style="--0:#82AAFF;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3C63B3">> Emitted </span><span style="--0:#DD6B68;--1:#B73936">${</span><span style="--0:#D6DEEB;--1:#403F53">n</span><span style="--0:#DD6B68;--1:#B73936">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Effect</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runPromise</span><span style="--0:#D6DEEB;--1:#403F53">(Stream</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">runCollect</span><span style="--0:#D6DEEB;--1:#403F53">(stream))</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">then</span><span style="--0:#D6DEEB;--1:#403F53">(console</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#7FDBCA;--1:#097174">log</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">/*</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Example Output:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 0 after 16ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 0 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 1 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 1 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 2 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 2 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 3 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 3 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 4 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 4 after 1ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 5 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 5 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 6 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 6 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 7 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 8 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 9 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 10 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 10 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 11 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 12 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 13 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 13 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 14 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 15 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 16 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 17 after 11ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">> Emitted 17 after 0ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 18 after 12ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">Received 19 after 10ms</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">_id: 'Chunk',</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">values: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">0, 1,  2,  3,  4,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">    </span></span><span style="--0:#809191;--1:#616671">5, 6, 10, 13, 17</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#809191;--1:#616671">  </span></span><span style="--0:#809191;--1:#616671">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671">*/</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { Effect, Schedule, Stream, Chunk } from &#x22;effect&#x22;;let last = Date.now();const log = (message: string) =>  Effect.sync(() => {    const end = Date.now();    console.log(&#x60;${message} after ${end - last}ms&#x60;);    last = end;  });const stream = Stream.fromSchedule(Schedule.spaced(&#x22;10 millis&#x22;)).pipe(  Stream.take(20),  Stream.tap((n) => log(&#x60;Received ${n}&#x60;)),  Stream.throttle({    cost: Chunk.size,    duration: &#x22;200 millis&#x22;,    units: 5,    strategy: &#x22;enforce&#x22;,    burst: 2,  }),  Stream.tap((n) => log(&#x60;> Emitted ${n}&#x60;)));Effect.runPromise(Stream.runCollect(stream)).then(console.log);/*Example Output:Received 0 after 16ms> Emitted 0 after 0msReceived 1 after 12ms> Emitted 1 after 0msReceived 2 after 11ms> Emitted 2 after 0msReceived 3 after 11ms> Emitted 3 after 0msReceived 4 after 11ms> Emitted 4 after 1msReceived 5 after 11ms> Emitted 5 after 0msReceived 6 after 12ms> Emitted 6 after 0msReceived 7 after 11msReceived 8 after 12msReceived 9 after 11msReceived 10 after 11ms> Emitted 10 after 0msReceived 11 after 11msReceived 12 after 11msReceived 13 after 12ms> Emitted 13 after 0msReceived 14 after 11msReceived 15 after 12msReceived 16 after 11msReceived 17 after 11ms> Emitted 17 after 0msReceived 18 after 12msReceived 19 after 10ms{  _id: &#x27;Chunk&#x27;,  values: [    0, 1,  2,  3,  4,    5, 6, 10, 13, 17  ]}*/"><div></div></button></div></figure></div>
<p>In this setup, the stream starts with a bucket containing 5 tokens, allowing the first five chunks to be emitted instantly.
The additional burst capacity of 2 accommodates further emissions momentarily, allowing for handling of subsequent data more flexibly.
Over time, as the bucket refills according to the throttle configuration, additional elements are emitted, demonstrating how the burst capability can manage uneven data flows effectively.</p> </div> <footer class="sl-flex astro-gcr56zec"> <div class="meta sl-flex astro-gcr56zec">   </div> <div class="pagination-links astro-qepcwt4y" dir="ltr"> <a href="/guides/streaming/stream/300-resourceful-streamsmdx_ja/" rel="prev" class="astro-qepcwt4y"> <svg aria-hidden="true" class="astro-qepcwt4y astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-qepcwt4y"> Previous <br class="astro-qepcwt4y"> <span class="link-title astro-qepcwt4y">リソースフルなストリーム</span> </span> </a> <a href="/guides/streaming/stream/500-consuming-streamsmdx_ja/" rel="next" class="astro-qepcwt4y"> <svg aria-hidden="true" class="astro-qepcwt4y astro-mzbodlcp" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-qepcwt4y"> Next <br class="astro-qepcwt4y"> <span class="link-title astro-qepcwt4y">ストリームの消費</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>